\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mystyle}[2025/10/27 Package pour sections colorées]

\RequirePackage{xcolor}
\RequirePackage{titlesec}
\RequirePackage{calc}
\RequirePackage{array}
\RequirePackage{graphicx}
\RequirePackage{xkeyval}
\RequirePackage{pgffor}
\RequirePackage{xstring}

% Géométrie pour s'adapter au bi-colonne
\RequirePackage[a4paper, columnsep=1.5em, top=2cm, bottom=2cm, left=1.8cm, right=1.8cm]{geometry}

% --- Encodage Classique pour pdflatex ---
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[french]{babel}

% --- Packages de Style ---
\RequirePackage{fancyhdr}
\RequirePackage{abstract}
\RequirePackage{booktabs}
\RequirePackage{enumitem}

% --- Packages de Contenu ---
\RequirePackage{amsmath}
\RequirePackage{float}
\RequirePackage{algorithm}
\RequirePackage{algpseudocode}
\RequirePackage{hyperref} % DERNIER package

\makeatletter

% Variables internes corrigées
\def\MonPK@titlecolor{sectioncolor}
\def\MonPK@widthabstract{}
\newif\ifMonPK@showline

% Options corrigées
\DeclareOptionX{titlecolor}{\def\MonPK@titlecolor{#1}}
\DeclareOptionX{widthabstract}{\def\MonPK@widthabstract{#1}}
\DeclareOptionX{showline}[true]{%
  \csname MonPK@showline#1\endcsname
}

% Valeurs par défaut
\ExecuteOptionsX{
  titlecolor=sectioncolor,
  showline=true,
  widthabstract=0.9
}
\ProcessOptionsX\relax

% Couleur section par défaut
\definecolor{sectioncolor}{RGB}{23,52,90}

% Style liste
\setlist[itemize]{label=-}

% ----------------------
%      En-têtes
% ----------------------
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}

\fancyhead[R]{Big Data et Prise de Décision}
\fancyhead[L]{A. Kaoutar et A. Sara}
\fancyfoot[C]{\thepage}

\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% ----------------------
%    Sections colorées
% ----------------------
\titleformat{\section}
    {\bfseries\color{\MonPK@titlecolor}}
    {\thesection}
    {1ex}
    {}
    [\ifMonPK@showline
        \vspace{-0.5ex}\color{\MonPK@titlecolor}\titlerule
     \fi]

\titleformat{\subsection}
    {\normalfont\bfseries\color{sectioncolor}}
    {\thesubsection}
    {1ex}
    {}

% ----------------------
%      Abstract
% ----------------------
\renewenvironment{abstract}{
    \newlength{\abstractwidth}
    \setlength{\abstractwidth}{\MonPK@widthabstract\textwidth}

    \newlength{\abstractnamewidth}
    \setlength{\abstractnamewidth}{\widthof{\abstractname}}

    \newlength{\abstractLength}
    \setlength{\abstractLength}{\abstractwidth - \abstractnamewidth}

    \newcommand{\myrule}{\textcolor{\MonPK@titlecolor}{\rule{0.48\abstractLength}{0.8pt}}}

    \vspace{1ex}
    \small
    \begin{center}
    \begin{minipage}{\abstractwidth}
    \myrule\hfill\textsc{\textbf{\textcolor{\MonPK@titlecolor}{\abstractname}}}\hfill\myrule
}{
    \end{minipage}
    \vskip1ex
    \textcolor{\MonPK@titlecolor}{\rule{\abstractwidth}{0.8pt}}
    \end{center}
}

% ----------------------
%      Keywords
% ----------------------
% keywords macro robuste : accepte "a,b,c" ou "a.b.c" ou mix, et met un point final une seule fois
\newcommand{\keywords}[1]{%
  \begingroup
  % raw input
  \def\rawinput{#1}%
  % si l'utilisateur a mis un point final, on l'enlève pour le moment
  \IfEndWith{\rawinput}{.}{%
    \StrGobbleRight{\rawinput}{1}[\tmpinput]%
  }{%
    \def\tmpinput{\rawinput}%
  }%
  % remplacer tous les points intérieurs par des virgules (pour uniformiser)
  \StrSubstitute{\tmpinput}{.}{,}[\cleaninput]%
  %
  % compter les éléments (séparés par virgule)
  \newcount\kwtotal
  \kwtotal=0
  \foreach \_ in {\cleaninput} { \advance\kwtotal by 1 }%
  %
  % affichage final : virgules entre éléments, point final seul
  \begin{flushleft}
    \fcolorbox{sectioncolor}{white}{\textbf{\textcolor{sectioncolor}{Keywords}}} :\;
    \foreach \word [count=\i] in {\cleaninput} {%
      \word%
      \ifnum\i<\kwtotal ,\space \else.\fi
    }%
  \end{flushleft}
  \endgroup
}

\makeatother
\endinput    

